<div class="page"/>

# ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰

"ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå‡¦ç†ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

* é€ã‚ŠçŠ¶(invoice.json)ã®ä»£ã‚ã‚Šã«ã€åŒç­‰ã®å†…å®¹ã‚’å«ã‚€Excelå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦ã€è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€åº¦ã«ç™»éŒ²ã™ã‚‹ã€‚
* 1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ã«ç™»éŒ²ã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€1å€‹ã§ã‚‚è¤‡æ•°ã§ã‚‚æ§‹ã‚ãªã„ã€‚ãŸã ã—ã€è¤‡æ•°å€‹ã®å ´åˆã¯ã€zipåœ§ç¸®ã—ã¦1ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã€‚
* æ§‹é€ åŒ–å‡¦ç†ã¯ã€é€šå¸¸ã®"ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã®å ´åˆã¨åŒæ§˜ã«å®Ÿè£…ã•ã‚Œã‚‹ã€‚
* 1ã¤ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ã«ç™»éŒ²ã•ã‚Œã‚‹é€ã‚ŠçŠ¶ãƒ‡ãƒ¼ã‚¿ã¯ã€Excelãƒ•ã‚¡ã‚¤ãƒ«ã®1è¡Œã«è¨˜è¿°ã•ã‚Œã‚‹ã€‚
* ç”»é¢ã‹ã‚‰å…¥åŠ›ã•ã‚ŒãŸé€ã‚ŠçŠ¶ãƒ‡ãƒ¼ã‚¿(invoice.json)ã¯ã€ä¸€éƒ¨ã‚’é™¤ã**åˆ©ç”¨ã•ã‚Œãªã„**ã€‚

## ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰åˆ©ç”¨æ™‚ã®é–‹ç™ºæ¦‚è¦

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã‚’åˆ©ç”¨ã—ãŸæ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®é–‹ç™ºã¯ä»¥ä¸‹ã®ã‚ˆã†ãªæµã‚Œã§å®Ÿæ–½ã—ã¾ã™ã€‚

1. (é€šå¸¸ã®)ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’é–‹ç™ºã™ã‚‹ã€‚
2. ä¸Šã§ä½œæˆã—ãŸé€ã‚ŠçŠ¶è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«(invoice.schema.json)ã®å½¢å¼ã«åˆã‚ã›ã¦ã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(xlsxå½¢å¼)ã‚’ä½œæˆã™ã‚‹ã€‚å¿…è¦ã§ã‚ã‚Œã°invoice.jsonã®å†…å®¹ã‚’ã€ã“ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã«è»¢è¨˜ã™ã‚‹ã€‚
3. ä¸Šè¨˜ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã§æŒ‡å®šã—ãŸãƒ•ã‚¡ã‚¤ãƒ«(å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«)ã‚’ä½œæˆã™ã‚‹ã€‚
4. ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ã®å‹•ä½œç¢ºèª

> æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¨ã—ã¦ã¯ã€"ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã¨"ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã§ã®é•ã„ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚RDEToolKitãŒè‡ªå‹•çš„ã«åˆ¤åˆ¥ã—ã€é©åˆ‡ã«å‰å‡¦ç†ã‚’å®Ÿè¡Œã—ã¦ãã‚Œã‚‹ãŸã‚ã§ã™ã€‚

## æº–å‚™

### RDEToolKitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨åˆæœŸãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆä½œæˆ

ã€å…±é€šå‡¦ç†ã€ã®ç« ã§ç¤ºã—ãŸã‚ˆã†ã«ã€RDEToolKitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨ã€åˆæœŸãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã®ä½œæˆã‚’å®Ÿæ–½ã—ã¾ã™ã€‚

```bash
$ cd ${HOME}/rde-sample
$ mkdir excelinvoice
$ cd excelinvoice/

$ source ~/venv/bin/activate

(venv) $ python -m rdetoolkit init
ï¼š
(venv) $ cd container
```

ä»¥ä¸‹ã€åŒæ–¹ãŒå®Œäº†ã—ã¦ã„ã‚‹ã‚‚ã®ã¨ã—ã¦é€²ã‚ã¾ã™ã€‚

### ãƒ•ã‚©ãƒ«ãƒ€åˆæœŸåŒ–

å‰ç« åŒæ§˜ã€ä»¥ä¸‹ã®å†…å®¹ã§åˆæœŸåŒ–ç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚

reinit.sh

```bash
#!/bin/bash


# ./data/inputdata
#  -> ä½•ã‚‚ã—ãªã„

#./data/job.failed
if [ -f ./data/job.failed ];then
    echo "./data/job.failed was removed"
    rm -f ./data/job.failed
fi

# ./data/invoice
#  -> ä½•ã‚‚ã—ãªã„

#./data/tasksupport
#  -> ä½•ã‚‚ã—ãªã„

#./modules
#  -> ä½•ã‚‚ã—ãªã„

#./requirements.txt
#  -> ä½•ã‚‚ã—ãªã„

D="
./data/divided
./data/logs
./data/attachment
./data/invoice_patch
./data/meta
./data/main_image
./data/other_image
./data/raw
./data/nonshared_raw
./data/structured
./data/temp
./data/thumbnail
"
for d in ${D};do
    echo "${d} was removed"
    rm -rf ${d}
done

# Python cache
rm -rf modules/__pycache__
```

å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ã—ã¾ã™ã€‚

```bash
chmod a+x reinit.sh
```

## ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®é–‹ç™º (ãã®1)

"ãã®1"ã¨ã—ã¦ã€'Hello RDE!'ã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã®æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆå®Ÿè¡Œã™ã‚‹ã“ã¨ã«ã‚ˆã‚Šã€å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ãŒéå…¬é–‹(ã¾ãŸã¯å…¬é–‹)ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã‚‹ã¨ã“ã‚ã¾ã§ã‚’å®Ÿè£…ã€ç¢ºèªã—ã¾ã™ã€‚

### ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿é…ç½®

ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã€ä»¥ä¸‹ã‚’é…ç½®ã—ã¾ã™ã€‚

* sample-data.txt (0KB)

0ãƒã‚¤ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã®ã§ã€`touch`ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šè¨­ç½®ã—ã¾ã™ã€‚

```bash
(venv) $ touch data/inputdata/sample-data.txt
```

å®Ÿéš›ã«æ ¼ç´ã•ã‚Œã‚‹ã¨ã€ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ ls -l data/inputdata/
total 0
-rw-r--r-- 1 devel devel 0  5æœˆ 16 07:55 sample-data.txt
```

> ä¸Šè¨˜ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ã¯"0ãƒã‚¤ãƒˆ"ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚ã“ã®ä¾‹ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿å‡¦ç†ã‚’è¡Œã‚ãªã„ãƒ€ãƒŸãƒ¼å®Ÿè£…ã®ãŸã‚ã§ã™ã€‚`nonshared_raw/`ãƒ•ã‚©ãƒ«ãƒ€ã¸ã®ã‚³ãƒ”ãƒ¼ã®ã¿å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

### æ§‹é€ åŒ–å‡¦ç†ä½œæˆ

ã“ã“ã‹ã‚‰ã€å®Ÿéš›ã«æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

#### main.py

åˆæœŸåŒ–ã«ã¦ä½œæˆã•ã‚ŒãŸmain.pyã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚

main.py

```python
import rdetoolkit

from modules import datasets_process


def main() -> None:
    rdetoolkit.workflows.run(
        custom_dataset_function=datasets_process.dataset,
    )

if __name__ == "__main__":
    main()
```

### modules/datasets_process.py

modules/datasets_process.py

```python
from rdetoolkit.errors import catch_exception_with_message
from rdetoolkit.models.rde2types import RdeInputDirPaths, RdeOutputResourcePath


@catch_exception_with_message(error_message="ERROR: failed in data processing")
def dataset(srcpaths: RdeInputDirPaths, resource_paths: RdeOutputResourcePath) -> None:
    print('Hello RDE!')
```

å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚

```bash
(venv) $ python main.py
Hello RDE!
```

æƒ³å®šé€šã‚Šã«è¡¨ç¤ºã•ã‚Œã¾ã—ãŸã€‚

å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ç¢ºèªã—ã¾ã™ã€‚

```bash
(venv) $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ inputdata
â”‚Â Â  â””â”€â”€ sample-data.txt
â”œâ”€â”€ invoice
â”‚Â Â  â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”œâ”€â”€ nonshared_raw
â”‚Â Â  â””â”€â”€ sample-data.txt
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”œâ”€â”€ tasksupport
â”‚Â Â  â”œâ”€â”€ invoice.schema.json
â”‚Â Â  â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â””â”€â”€ thumbnail

15 directories, 5 files
```

`sample-data.txt`ãŒã€æƒ³å®šé€šã‚Š`nonshared_raw/`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã™ã€‚

## ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®é–‹ç™º (ãã®2)

æ¬¡ã«ã€å®Ÿåƒã™ã‚‹æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã€é€ã‚ŠçŠ¶ãƒ•ã‚¡ã‚¤ãƒ«(invoice.json)ãªã©ã®é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

å…ˆã«é–¢é€£ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

### invoice.json

é€ã‚ŠçŠ¶ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚

data/invoice/invoice.json

```json
{
    "datasetId": "e751fcc4-b926-4747-b236-cab40316fc49",
    "basic": {
        "dateSubmitted": "2023-03-14",
        "dataOwnerId": "16b51e451d6be669bb93b551420ec005b1df55b83530316137643764",
        "dataName": "test_spe1",
        "instrumentId": null,
        "experimentId": "test_230606_1",
        "description": "test_today"
    },
    "custom": {
        "common_data_origin": "experiments",
        "common_technical_category": "measurement",
        "measurement_method_category": "æ•£ä¹±_å›æŠ˜",
        "measurement_method_sub_category": "Xç·šå›æŠ˜",
        "measurement_analysis_field": null,
        "measurement_measurement_environment": null,
        "measurement_energy_level_transition_structure_etc_of_interst": null,
        "measurement_measured_date": "2017-11-21",
        "measurement_standardized_procedure": null,
        "measurement_instrumentation_site": null,
        "measurement_reference": null,
        "measurement_temperature": null,
        "sample_holder_name": null,
        "key2": "test2",
        "key3": "test3",
        "key4": "test4",
        "key5": "test5",
        "key6": "test6",
        "key7": "test7",
        "key8": "test8",
        "key9": "test9",
        "key10": "test10",
        "flood_gun_voltage": 1,
        "flood_gun_emission_current": 0,
        "ion_gun_voltage": 0,
        "analysis_field": "test_myfield",
        "sample_position": "test_#1",
        "sample_condition": "test_condition",
        "no3dimage": 0
    },
    "sample": {
        "sampleId": "8ea50153-7a87-44b7-9d6e-10179c507039",
        "names": [
            "testdev01_1"
        ],
        "composition": "AB2C3",
        "referenceUrl": "test_ref",
        "description": null,
        "generalAttributes": [
            {
                "termId": "3adf9874-7bcb-e5f8-99cb-3d6fd9d7b55e",
                "value": "test_ABC"
            },
            {
                "termId": "e2d20d02-2e38-2cd3-b1b3-66fdb8a11057",
                "value": "b"
            },
            {
                "termId": "efcf34e7-4308-c195-6691-6f4d28ffc9bb",
                "value": "c"
            },
            {
                "termId": "7cc57dfb-8b70-4b3a-5315-fbce4cbf73d0",
                "value": "d"
            },
            {
                "termId": "1e70d11d-cbdd-bfd1-9301-9612c29b4060",
                "value": "e"
            },
            {
                "termId": "5e166ac4-bfcd-457a-84bc-8626abe9188f",
                "value": "f"
            },
            {
                "termId": "0d0417a3-3c3b-496a-b0fb-5a26f8a74166",
                "value": "g"
            }
        ],
        "ownerId": "de17c7b3f0ff5126831c2d519f481055ba466ddb6238666132316439"
    }
}
```

ä¸€éƒ¨ã®é …ç›®ã¯ã€`invoice.schema.json`ã§ã¯**ãªã„**ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°`"ownerId": "test_owner"`ã®ã‚ˆã†ãªæŒ‡å®šã‚’ã™ã‚‹ã¨ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚


ã“ã‚Œã¯`(RDEToolKitã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒ•ã‚©ãƒ«ãƒ€)/static/invoice_basic_and_sample.schema_.json`ã§æŒ‡å®šã—ã¦ã„ã‚‹ã€ä»¥ä¸‹ã®å†…å®¹ã«åˆè‡´ã—ã¦ã„ãªã„ãŸã‚ã«å‡ºåŠ›ã•ã‚Œã¾ã™ã€‚

```json
ï¼š
                    "ownerId": {
                        "description": "sample owner id",
                        "type": "string",
                        "pattern": "^([0-9a-zA-Z]{56})$"
                    },
ï¼š
```

`invoice.schema.json`ã®æŒ‡å®šã¨æ¯”ã¹ã¦å•é¡ŒãŒãªã„ã®ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹å ´åˆã¯ã€ä¸Šè¨˜ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®šã¨åˆè‡´ã—ã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã®ã§ã€ãã¡ã‚‰ã‚‚åˆã‚ã›ã¦ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### invoice.schema.json

> åˆ¥é€”æä¾›ã•ã‚Œã¦ã„ã‚‹"Excelãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰jsonç”Ÿæˆ"ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ä½œæˆã—ãŸ`invoice.schema.json`ã¯"description"éƒ¨åˆ†ãŒå…¥ã‚‰ãªã„(â†’ "None"ãŒæŒ‡å®šã•ã‚Œã‚‹)ã®ã§ã€å‡ºæ¥ä¸ŠãŒã£ãŸjsonãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å‹•ã«ã¦ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™(ä¸‹è¨˜ã¯ä¿®æ­£æ¸ˆã¿)ã€‚

data/tasksupport/invoice.schema.json

```json
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "NIMS_ELN_Process_Pulsed_laser_deposition_Magnetic_thin_film",
  "description": "å›ºæœ‰æƒ…å ±ã¨è©¦æ–™æƒ…å ±ã®ã‚¹ã‚­ãƒ¼ãƒ",
  "type": "object",
  "required": [
      "custom",
      "sample"
  ],
  "properties": {
      "custom": {
          "type": "object",
          "label": {
              "ja": "å›ºæœ‰æƒ…å ±",
              "en": "Custom Information"
          },
          "required": [],
          "properties": {
              "date": {
                  "label": {
                      "ja": "æ—¥ä»˜",
                      "en": "Date"
                  },
                  "type": "string"
              },
              "substrate": {
                  "label": {
                      "ja": "åŸºæ¿",
                      "en": "Substrate"
                  },
                  "type": "string"
              },
              "target": {
                  "label": {
                      "ja": "å±¤æ§‹é€ ",
                      "en": "Target"
                  },
                  "type": "string"
              },
              "tg": {
                  "label": {
                      "ja": "æˆè†œæ¸©åº¦",
                      "en": "Tg"
                  },
                  "type": "number",
                  "options": {
                      "unit": "C"
                  }
              },
              "po2": {
                  "label": {
                      "ja": "æˆè†œé…¸ç´ åœ§",
                      "en": "PO2"
                  },
                  "type": "number",
                  "options": {
                      "unit": "Torr"
                  }
              },
              "laser_fluence": {
                  "label": {
                      "ja": "ãƒ¬ãƒ¼ã‚¶ãƒ¼å¼·åº¦",
                      "en": "Laser fluence"
                  },
                  "type": "number",
                  "options": {
                      "unit": "mJ/pulse"
                  }
              },
              "spot_size": {
                  "label": {
                      "ja": "ãƒ¬ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒãƒƒãƒˆã‚µã‚¤ã‚º",
                      "en": "Spot Size"
                  },
                  "type": "number",
                  "options": {
                      "unit": "mm^2"
                  }
              },
              "frequency": {
                  "label": {
                      "ja": "ãƒ¬ãƒ¼ã‚¶ãƒ¼å‘¨æ³¢æ•°",
                      "en": "Frequency"
                  },
                  "type": "number",
                  "options": {
                      "unit": "Hz"
                  }
              },
              "pulse_count": {
                  "label": {
                      "ja": "æˆè†œãƒ‘ãƒ«ã‚¹æ•°",
                      "en": "Pulse Count"
                  },
                  "type": "string"
              },
              "key1": {
                  "label": {
                      "ja": "ã‚­ãƒ¼1",
                      "en": "key1"
                  },
                  "type": "string"
              },
              "key2": {
                  "label": {
                      "ja": "ã‚­ãƒ¼2",
                      "en": "key2"
                  },
                  "type": "string"
              },
              "key3": {
                  "label": {
                      "ja": "ã‚­ãƒ¼3",
                      "en": "key3"
                  },
                  "type": "string"
              },
              "key4": {
                  "label": {
                      "ja": "ã‚­ãƒ¼4",
                      "en": "key4"
                  },
                  "type": "string"
              },
              "key5": {
                  "label": {
                      "ja": "ã‚­ãƒ¼5",
                      "en": "key5"
                  },
                  "type": "string"
              },
              "common_data_type": {
                  "label": {
                      "ja": "ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ—",
                      "en": "Data Type"
                  },
                  "type": "string",
                  "default": "ELN"
              },
              "common_data_origin": {
                  "label": {
                      "ja": "ãƒ‡ãƒ¼ã‚¿ã®èµ·æº",
                      "en": "Data Origin"
                  },
                  "type": "string",
                  "default": "experiments"
              },
              "common_technical_category": {
                  "label": {
                      "ja": "æŠ€è¡“ã‚«ãƒ†ã‚´ãƒªãƒ¼",
                      "en": "Technical Category"
                  },
                  "type": "string",
                  "default": "process"
              },
              "common_reference": {
                  "label": {
                      "ja": "å‚è€ƒæ–‡çŒ®",
                      "en": "Reference"
                  },
                  "type": "string"
              },
              "process_processed_date": {
                  "label": {
                      "ja": "å‡¦ç†å¹´æœˆæ—¥",
                      "en": "Processed date"
                  },
                  "type": "string",
                  "format": "date"
              },
              "process_process_category": {
                  "label": {
                      "ja": "ãƒ—ãƒ­ã‚»ã‚¹ã‚«ãƒ†ã‚´ãƒªãƒ¼",
                      "en": "Process category"
                  },
                  "type": "string",
                  "default": "è’¸ç€_æˆè†œ"
              },
              "process_process_technique": {
                  "label": {
                      "ja": "ãƒ—ãƒ­ã‚»ã‚¹æ‰‹æ³•",
                      "en": "Process technique"
                  },
                  "type": "string",
                  "default": "ãƒ‘ãƒ«ã‚¹ãƒ¬ãƒ¼ã‚¶å †ç©"
              },
              "process_processing_environment": {
                  "label": {
                      "ja": "å‡¦ç†ç’°å¢ƒ",
                      "en": "Processing environment"
                  },
                  "type": "string",
                  "default": "çœŸç©ºä¸­"
              },
              "process_key_temperature": {
                  "label": {
                      "ja": "ä¸»ã¨ãªã‚‹å‡¦ç†æ¸©åº¦",
                      "en": "Key temperature"
                  },
                  "type": "number",
                  "options": {
                      "unit": "C"
                  }
              },
              "process_instrumentation_site": {
                  "label": {
                      "ja": "è£…ç½®è¨­ç½®å ´æ‰€",
                      "en": "Instrumentation site"
                  },
                  "type": "string"
              },
              "process_standardized_procedure": {
                  "label": {
                      "ja": "æ¨™æº–æ‰‹é †",
                      "en": "Standardized procedure"
                  },
                  "type": "string"
              }
          }
      },
      "sample": {
        "type": "object",
        "label": {
            "ja": "è©¦æ–™æƒ…å ±",
            "en": "Sample Information"
        },
        "required": [
        ],
        "properties": {
            "generalAttributes": {
                "type": "array",
                "items": [
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "3adf9874-7bcb-e5f8-99cb-3d6fd9d7b55e"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "e2d20d02-2e38-2cd3-b1b3-66fdb8a11057"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "efcf34e7-4308-c195-6691-6f4d28ffc9bb"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "7cc57dfb-8b70-4b3a-5315-fbce4cbf73d0"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "1e70d11d-cbdd-bfd1-9301-9612c29b4060"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "5e166ac4-bfcd-457a-84bc-8626abe9188f"
                            }
                        }
                    },
                    {
                        "type": "object",
                        "required": [
                            "termId"
                        ],
                        "properties": {
                            "termId": {
                                "const": "0d0417a3-3c3b-496a-b0fb-5a26f8a74166"
                            }
                        }
                    }
                ]
            }
        }
    }
  }
}
```

### metadata-def.json

metadata-def.jsonã‚’ä»¥ä¸‹ã®å†…å®¹ã§ä½œæˆã—ã¾ã™ã€‚

data/tasksupport/metadata-def.json

```json
{
    "file_size": {
        "name": {
            "ja": "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º",
            "en": "file size"
        },
        "schema": {
            "type": "number"
        },
        "description": "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º",
        "variable":1,
        "unit" : "byte"
    },
    "file_created": {
        "name": {
            "ja": "ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ—¥",
            "en": "file created at"
        },
        "schema": {
            "type": "string",
            "format": "date"
        },
        "description": "ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ—¥"
    },
    "file_name": {
        "name": {
            "ja": "ãƒ•ã‚¡ã‚¤ãƒ«å",
            "en": "file name"
        },
        "schema": {
            "type": "string"
        },
        "description": "ãƒ•ã‚¡ã‚¤ãƒ«å"
    }
}
```

> "file_size"ã‚’ç¹°ã‚Šè¿”ã—æœ‰ã‚Šãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é …ç›®ã¨ã—ã¦å®šç¾©ã—ã¦ã„ã¾ã™ã€‚å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯1ã¤ã§ã™ã®ã§æœ¬æ¥ã¯é€šå¸¸ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é …ç›®ã§ã™ãŒã€ã“ã“ã§ã¯ä¾‹ã‚’ç¤ºã™æ„å‘³ã§"ç¹°ã‚Šè¿”ã—æœ‰ã‚Š"ã¨ã—ã¦ã„ã¾ã™ã€‚ç¹°ã‚Šè¿”ã—ã®ãªã„ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿é …ç›®ã¨ã—ã¦æ‰±ã†å ´åˆã¯"variable: 1"ã®è¡Œã‚’å‰Šé™¤ã—ã¾ã™ã€‚

ç¶šã„ã¦ã€æ§‹é€ åŒ–å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

> ã“ã“ã§ã¯ã‚µãƒ³ãƒ—ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ã‚’ä¸»é¡Œã«ã—ã¦ã„ã¾ã™ã®ã§ã€ä¸€éƒ¨ã®å‡¦ç†ãŒæ„å‘³ã®ç„¡ã„å‡¦ç†ã®ã¾ã¾ã¨ãªã£ã¦ã„ã¾ã™ã€‚

### modules/interfaces.py

```python
from __future__ import annotations

from abc import ABC, abstractmethod
from pathlib import Path
from typing import Any, Generic, TypeVar

import pandas as pd
from rdetoolkit.models.rde2types import MetaType, RepeatedMetaType
from rdetoolkit.rde2util import Meta

T = TypeVar("T")


class IInputFileParser(ABC):
    @abstractmethod
    def read(self, path: Path) -> Any:  # noqa: D102
        raise NotImplementedError


class IStructuredDataProcessor(ABC):
    @abstractmethod
    def to_csv(self, dataframe: pd.DataFrame, save_path: Path, *, header: list[str] | None = None) -> Any:  # noqa: D102
        raise NotImplementedError


class IMetaParser(Generic[T], ABC):
    @abstractmethod
    def parse(self, data: T) -> Any:  # noqa: D102
        raise NotImplementedError

    @abstractmethod
    def save_meta(
        self, save_path: Path, meta: Meta, *, const_meta_info: MetaType | None = None, repeated_meta_info: RepeatedMetaType | None = None,
    ) -> Any:
        raise NotImplementedError


class IGraphPlotter(Generic[T], ABC):
    @abstractmethod
    def plot(self, data: T, save_path: Path, *, title: str | None = None, xlabel: str | None = None, ylabel: str | None = None) -> Any:  # noqa: D102
        raise NotImplementedError
```

### modules/inputfile_handler.py

```python
from __future__ import annotations

from pathlib import Path
from typing import Any
from datetime import datetime

import pandas as pd
from rdetoolkit.models.rde2types import MetaType

from modules.interfaces import IInputFileParser


class FileReader(IInputFileParser):
    def read(self, srcpath: Path) -> tuple[MetaType, pd.DataFrame]:
        file_size = srcpath.stat().st_size
        file_created = datetime.fromtimestamp(srcpath.stat().st_mtime).strftime("%Y-%m-%d")
        self.data = pd.DataFrame([[1, 11], [2, 22], [3, 33]]) # Caution! dummy data
        self.meta: dict[str, str | int | float | list[Any] | bool] = {
            "file_size": file_size,
            "file_created": file_created,
            "file_name": srcpath.name
        }

        return self.meta, self.data
```

> ä¸Šè¨˜ä¾‹ã§ã¯ã€ã‚½ãƒ¼ã‚¹ä¸­ã®ã‚³ãƒ¡ãƒ³ãƒˆã«ã‚‚ã‚ã‚‹ã‚ˆã†ã«ã€è¿”å´ã•ã‚Œã‚‹dataã¯(å›ºå®šã®)ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚

### modules/meta_handler.py

```python
from __future__ import annotations

from pathlib import Path
from typing import Any

from rdetoolkit import rde2util
from rdetoolkit.models.rde2types import MetaType, RepeatedMetaType

from modules.interfaces import IMetaParser


class MetaParser(IMetaParser[MetaType]):
    def parse(self, data: MetaType) -> tuple[MetaType, RepeatedMetaType]:
        """Parse and extract constant and repeated metadata from the provided data."""
        # dummy return
        self.const_meta_info: MetaType = data
        self.repeated_meta_info: RepeatedMetaType = {"key": ["key_value1", "key_value2"], "sample": ["sample_value1", "sample_value2"]}
        return self.const_meta_info, self.repeated_meta_info

    def save_meta(  # noqa: ANN201
        self,
        save_path: Path,
        metaobj: rde2util.Meta,
        *,
        const_meta_info: MetaType | None = None,
        repeated_meta_info: RepeatedMetaType | None = None,
    ) -> Any:
        """Save parsed metadata to a file using the provided Meta object."""
        if const_meta_info is None:
            const_meta_info = self.const_meta_info
        if repeated_meta_info is None:
            repeated_meta_info = self.repeated_meta_info
        metaobj.assign_vals(const_meta_info)
        metaobj.assign_vals(repeated_meta_info)

        # dummy return
        return metaobj.writefile(str(save_path))
```

> ä¸Šè¨˜ä¾‹ã§ã¯ã€parseãƒ¡ã‚½ãƒƒãƒ‰ã¯å…¨ãã®ãƒ€ãƒŸãƒ¼ã§ã™ã€‚

### modules/graph_handler.py

```python
from __future__ import annotations

from pathlib import Path

import pandas as pd

from modules.interfaces import IGraphPlotter


class GraphPlotter(IGraphPlotter[pd.DataFrame]):
    def plot(self, data: pd.DataFrame, save_path: Path, *, title: str | None = None, xlabel: str | None = None, ylabel: str | None = None) -> pd.DataFrame:
        return data  # dummy return value for testing purposes
```

> ä¸Šè¨˜ä¾‹ã§ã¯ã€plotãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ€ãƒŸãƒ¼å®Ÿè£…ã§ã‚ã‚Šã€å®Ÿéš›ã«ã¯ä½•ã‚‚å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚

### modules/structured_handler.py

```python
from __future__ import annotations

from pathlib import Path

import pandas as pd

from modules.interfaces import IStructuredDataProcessor


class StructuredDataProcessor(IStructuredDataProcessor):
    def to_csv(self, dataframe: pd.DataFrame, save_path: Path, *, header: list[str] | None = None) -> None:
        if header is not None:
            dataframe.to_csv(save_path, header=header, index=False)
        else:
            dataframe.to_csv(save_path, index=False)
```

### modules/datasets_process.py

æœ€å¾Œã«ã€ä¸Šã§è¨˜è¿°ã—ãŸå‡¦ç†ã‚’ä½¿ã†ã‚ˆã†ã«datasetãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

> å…ƒã‹ã‚‰ã‚ã‚‹å†…å®¹ã‚’ã€ä¸‹è¨˜å†…å®¹ã§ä¸Šæ›¸ãã—ã¾ã™ã€‚

```python
from rdetoolkit.errors import catch_exception_with_message
from rdetoolkit.models.rde2types import RdeInputDirPaths, RdeOutputResourcePath
from rdetoolkit.rde2util import Meta

from modules.inputfile_handler import FileReader
from modules.meta_handler import MetaParser
from modules.graph_handler import GraphPlotter
from modules.structured_handler import StructuredDataProcessor


class CustomProcessingCoordinator:
    def __init__(
        self,
        file_reader: FileReader,
        meta_parser: MetaParser,
        graph_plotter: GraphPlotter,
        structured_processer: StructuredDataProcessor
    ):
        self.file_reader = file_reader
        self.meta_parser = meta_parser
        self.graph_plotter = graph_plotter
        self.structured_processer = structured_processer


def custom_module(srcpaths: RdeInputDirPaths, resource_paths: RdeOutputResourcePath) -> None:
    co = CustomProcessingCoordinator(
             FileReader(),
             MetaParser(),
             GraphPlotter(),
             StructuredDataProcessor()
         )

    # Read Input File
    inputfile = resource_paths.rawfiles[0] # Only one input file is expected
    meta, df_data = co.file_reader.read(inputfile)

    # Save csv
    co.structured_processer.to_csv(
        df_data,
        resource_paths.struct / "sample.csv"
    )

    # Meta
    co.meta_parser.parse(meta)
    co.meta_parser.save_meta(
        resource_paths.meta / "metadata.json",
        Meta(srcpaths.tasksupport / "metadata-def.json")
    )

    # Graph
    co.graph_plotter.plot(
        df_data,
        resource_paths.main_image / "sample.png"
    )


@catch_exception_with_message(error_message="ERROR: failed in data processing")
def dataset(srcpaths: RdeInputDirPaths, resource_paths: RdeOutputResourcePath) -> None:
    custom_module(srcpaths, resource_paths)
```

> ä¸Šè¨˜ä¾‹ã§ã¯ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§å›ºå®šã§è¨˜è¿°ã™ã‚‹ãªã©ã€å®Ÿéš›ã®æ§‹ç¯‰ã®éš›ã«ã¯ãã†ã™ã‚‹ã¹ãã§ãªã„å®Ÿè£…ãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

ã“ã®çŠ¶æ…‹ã§å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ python main.py 
(venv) $ 
```

> Excelã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥åŠ›ã¨ã—ã¦ã„ã¾ã›ã‚“ã®ã§ã€ã“ã®æ™‚ç‚¹ã§ã¯"ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã¨ãªã£ã¦ã„ã¾ã™ã€‚

çµæœã€ä»¥ä¸‹ã®æ§˜ã«å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’rawãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å‡¦ç†ã ã‘ãŒå®Ÿæ–½ã•ã‚Œã¾ã™ã€‚ã‚°ãƒ©ãƒ•ä½œæˆå‡¦ç†ãŒãƒ€ãƒŸãƒ¼ãªã®ã§ã€ã‚¤ãƒ¡ãƒ¼ã‚¸ç³»ã®ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```bash
(venv) $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ inputdata
â”‚Â Â  â””â”€â”€ sample-data.txt
â”œâ”€â”€ invoice
â”‚Â Â  â””â”€â”€ invoice.json
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”‚Â Â  â””â”€â”€ metadata.json
â”œâ”€â”€ nonshared_raw
â”‚Â Â  â””â”€â”€ sample-data.txt
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”‚Â Â  â””â”€â”€ sample.csv
â”œâ”€â”€ tasksupport
â”‚Â Â  â”œâ”€â”€ invoice.schema.json
â”‚Â Â  â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â””â”€â”€ thumbnail

15 directories, 7 files
```

## ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®é–‹ç™º

> data/inputdata/ãƒ•ã‚©ãƒ«ãƒ€ã«ã€æ¡ä»¶ã‚’æº€ãŸã™Excelå½¢å¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã€è‡ªå‹•çš„ã«"ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰"ã¨ãªã‚Šã¾ã™ã€‚å¾“ã£ã¦ã€`ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰`ã‚’ä½¿ã†ãŸã‚ã«ã€main.pyã‚’ä¿®æ­£ã—ã¦Config()ã‚’ä½¿ã£ãŸãƒ¢ãƒ¼ãƒ‰æŒ‡å®šã™ã‚‹ã¨ã„ã£ãŸ**è¿½åŠ æŒ‡å®šã¯ä¸è¦**ã§ã™ã€‚

### ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿é…ç½®

é€šå¸¸ã®ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ã®é–‹ç™ºãŒæ¸ˆã‚“ã§ã„ã‚‹ã®ã§ã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã§ã®ç¢ºèªã‚’é€²ã‚ã¾ã™ã€‚

ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚

```bash
(venv) $ ./reinit.sh 
./data/divided was removed
./data/logs was removed
./data/attachment was removed
./data/invoice_patch was removed
./data/meta was removed
./data/main_image was removed
./data/other_image was removed
./data/raw was removed
./data/nonshared_raw was removed
./data/structured was removed
./data/temp was removed
./data/thumbnail was removed
```

ä¸Šã§ä½¿ç”¨ã—ãŸãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«(`sample-data.txt`)ã¯ã€ä¸è¦ã§ã™ã®ã§å‰Šé™¤ã—ã¾ã™ã€‚

```bash
rm data/inputdata/sample-data.txt
```

ã¾ãŸã€invoice.jsonãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ä»¥ä¸‹ã®æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œã§ä¸Šæ›¸ãã•ã‚Œã¾ã™ã®ã§ã€å¿µã®ãŸã‚ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãŠãã¾ã™ã€‚

```bash
cp data/invoice/invoice.json data/invoice/invoice.json.orig
```

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®ãƒ†ã‚¹ãƒˆç”¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
(venv) $ echo '0000' > data0000.dat
(venv) $ echo '0001' > data0001.dat
(venv) $ echo '0002' > data0002.dat

(venv) $ zip data.zip ./data0000.dat ./data0001.dat ./data0002.dat
  adding: data0000.dat (stored 0%)
  adding: data0001.dat (stored 0%)
  adding: data0002.dat (stored 0%)

(venv) $ ls -l data.zip
-rw-rw-r-- 1 devel devel 493  5æœˆ 16 08:13 data.zip
```

> zipã‚³ãƒãƒ³ãƒ‰ãŒãªã„å ´åˆã¯ã€`sudo apt install zip`ã«ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã‹ã‚‰ä½œæ¥­ã—ã¦ãã ã•ã„ã€‚

æ‰€å®šã®å ´æ‰€ã«é…ç½®ã—ã¾ã™ã€‚

```bash 
cp data.zip data/inputdata/
```

ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ ls -l data/inputdata/
total 4
-rw-rw-r-- 1 devel devel 493  5æœˆ 16 08:13 data.zip
```

æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒã€`ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰`ã‹`ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰`ã‹ã®ã„ãšã§å®Ÿè¡Œã•ã‚Œã‚‹ã‹ã‚’åˆ¤æ–­ã™ã‚‹ãƒã‚¤ãƒ³ãƒˆã¯ã€`data/inputdata`ãƒ•ã‚©ãƒ«ãƒ€ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`ã¨ãªã£ã¦ã„ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹ã‹ã©ã†ã‹ã€ã§ã™ã€‚å½“è©²ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚Œã°ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ç¨¼åƒã—ã¾ã™ã—ã€å­˜åœ¨ã—ãªã‘ã‚Œã°é€šå¸¸ã®ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦ç¨¼åƒã—ã¾ã™ã€‚

å…ˆã«ã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã«ã¤ã„ã¦èª¬æ˜ã—ã€ãã®å¾Œä½œæˆã—ã¾ã™ã€‚

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã€å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¯zipãƒ•ã‚¡ã‚¤ãƒ«(zipå½¢å¼ã®åœ§ç¸®ãƒ•ã‚¡ã‚¤ãƒ«)ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’å±•é–‹ã—ãŸæ™‚ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«1ã¤1ã¤ã‚’åˆ¥ã€…ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ã¨ã—ã¦ç™»éŒ²ã™ã‚‹ãƒ¢ãƒ¼ãƒ‰ã‚’"ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰"ã€å±•é–‹ã—ãŸã¨ãã«ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ã”ã¨ã«ãƒ•ã‚©ãƒ«ãƒ€ãŒåˆ¥ã«ãªã£ã¦ã„ã‚‹ã‚‚ã®ã‚’"ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰"ã¨ã„ã„ã¾ã™ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã¨ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ã§ã¯ã€ç™»éŒ²ã‚·ãƒ¼ãƒˆã‚’ä»¥ä¸‹ã®æ§˜ã«è¨­å®šã—ã¾ã™ã€‚
* ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ ï¼š A2ã‚»ãƒ«ã«"data_file_names"ã€A3ã‚»ãƒ«ã«"name"ã‚’ãã‚Œãã‚ŒæŒ‡å®š
* ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ ï¼š A2ã‚»ãƒ«ã«"data_folder"ã‚’æŒ‡å®š(A3ã‚»ãƒ«ã¯ä»»æ„)

5è¡Œç›®ä»¥é™ã®Aåˆ—ã«ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯å±•é–‹å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ•ã‚©ãƒ«ãƒ€åã‚’ãã‚Œãã‚ŒæŒ‡å®šã—ã¾ã™ã€‚

5è¡Œç›®ä»¥é™ã®ã€Båˆ—ä»¥é™ã¯ã‚¤ãƒ³ãƒœã‚¤ã‚¹(é€ã‚ŠçŠ¶)ã®å†…å®¹ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

> ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã®ç™»éŒ²ã‚·ãƒ¼ãƒˆã®æ›¸ãæ–¹ã«ã¤ã„ã¦ã¯ã€"https://dice.nims.go.jp/services/RDE/service_menu/catalog/manuals/excel_invoice/excel_invoice/" ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚
>
> ä¸Šã§ä½œæˆã—ãŸdata.zipã¯ã€å±•é–‹å¾Œãƒ•ã‚¡ã‚¤ãƒ«ã¨ãªã‚Šã¾ã™ã®ã§ã€`ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã®æ¡ä»¶

ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã«ã¯ã€ã„ãã¤ã‹ã®æ¡ä»¶ãŒã‚ã‚Šã¾ã™ã€‚

* xslxå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹ã“ã¨ã€‚
* ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`(æ‹¡å¼µå­ã‚’å«ã‚€)ã§ã‚ã‚‹ã“ã¨
* ã‚·ãƒ¼ãƒˆåã«ã¯åˆ¶é™ã¯ãªã„ãŒã€ç™»éŒ²ã«ä½¿ç”¨ã™ã‚‹ã‚·ãƒ¼ãƒˆ(ä»¥ä¸‹"ç™»éŒ²ã‚·ãƒ¼ãƒˆ"ã¨ã„ã„ã¾ã™)ã¯ã€å·¦ä¸Šç«¯ (A1ã‚»ãƒ«)ã®å€¤ãŒ"`invoiceList_format_id`"ã§ã‚ã‚‹ã“ã¨ã€‚
* å·¦ä¸Šç«¯ (A1ã‚»ãƒ«)ã®å€¤ãŒ"`invoiceList_format_id`"ã§ã‚ã‚‹ã‚·ãƒ¼ãƒˆãŒ1å€‹ã ã‘å­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ã€‚

ä»¥ä¸‹ã«ã€å…·ä½“çš„ã«èª¬æ˜ã—ã¾ã™ã€‚

#### xslxå½¢å¼ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚‹ã“ã¨

æ‹¡å¼µå­ãŒ`xls`ã®Excelãƒ•ã‚¡ã‚¤ãƒ«(å¤ã„å½¢å¼ã®Excelãƒ•ã‚¡ã‚¤ãƒ«)ã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚

`xsl`å½¢å¼ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’inputfileã¨ã—ã¦æŒ‡å®šã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ ls -l data/inputdata/
:
-rwxrwxr-x 1 devel devel 94720  2æœˆ  3 17:54 sample_excel_invoice.xls

(venv) $ python main.py
ï¼š
Exception Type: ImportError
Error: Missing optional dependency 'xlrd'. Install xlrd >= 2.0.1 for xls Excel support Use pip or conda to install xlrd.
```

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚ˆã†ã«ã€`xlrd`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥ã™ã‚Œã°ã†ã¾ãç¨¼åƒã™ã‚‹å¯èƒ½æ€§ã¯ã‚ã‚Šã¾ã™ãŒã€RDEToolKitã®ã‚µãƒãƒ¼ãƒˆå¤–ã¨ãªã‚Šã¾ã™ã€‚

#### ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`(æ‹¡å¼µå­ã‚’å«ã‚€)ã§ã‚ã‚‹ã“ã¨

ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`(æ‹¡å¼µå­ã‚’å«ã‚€)ã§ãªã„Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ãŸå ´åˆã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œã¯ã§ãã¾ã›ã‚“ã€‚

ä¸Šè¨˜å½¢å¼ã«å‰‡ã£ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«åã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’`data/inputdata`ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¦ã€`python main.py`ã‚’å®Ÿè¡Œã—ãŸå ´åˆã€å®Ÿè¡Œè‡ªä½“ã¯ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™(å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒã‚§ãƒƒã‚¯å†…å®¹æ¬¡ç¬¬)ã€‚

ã—ã‹ã—ã€æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰ã¯ã€å½“è©²Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒ`å˜ãªã‚‹å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã®1ã¤`ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚ã¤ã¾ã‚Šã€`ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰`ã§ã¯ãªãã€é€šå¸¸ã®`ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰`ã§ã®ç™»éŒ²ã¨ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€ãƒ•ã‚¡ã‚¤ãƒ«åã®æœ«å°¾ãŒ`_excel_invoice.xlsx`(æ‹¡å¼µå­ã‚’å«ã‚€)ã®Excelãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`data/inputdata/`ãƒ•ã‚©ãƒ«ãƒ€ã«1å€‹ã ã‘ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚å½“è©²æ¡ä»¶ã‚’æº€ãŸã™Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒ2ä»¶(ä»¥ä¸Š)ã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ ls -l data/inputdata/
:
-rwxrwxr-x 1 devel devel 56883  2æœˆ  7 11:26 ample_excel_invoice.xlsx
-rwxr-xr-x 1 devel devel 56883  2æœˆ  7 11:31 sample_excel_invoice.xlsx

(venv) $ python main.py

(â†’ ã“ã“ã§ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“)

(venv) $ cat data/job.failed
ErrorCode=1
ErrorMessage=ERROR: more than 1 excelinvoice file list. file num: 2
```

### ã‚·ãƒ¼ãƒˆã®åˆ¶é™

Excelãƒ•ã‚¡ã‚¤ãƒ«ãŒè¤‡æ•°ã®ã‚·ãƒ¼ãƒˆã‚’å«ã‚“ã§ã„ã‚‹å ´åˆã€ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã¨ã—ã¦ç™»éŒ²ã«ä½¿ç”¨ã™ã‚‹ã®ã¯ã€`ã‚·ãƒ¼ãƒˆå†…ã®A1ã‚»ãƒ«ã®å€¤ãŒ"invoiceList_format_id"ã§ã‚ã‚‹`ã‚·ãƒ¼ãƒˆ(ä»¥ä¸‹"ç™»éŒ²ã‚·ãƒ¼ãƒˆ"ã¨å‘¼ã³ã¾ã™)ã¨ãªã‚Šã¾ã™ã€‚

ç™»éŒ²ã‚·ãƒ¼ãƒˆãŒè¤‡æ•°ã‚ã‚‹å ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ python main.py

(venv) $ cat data/job.failed
ErrorCode=1
ErrorMessage=ERROR: multiple sheet in invoiceList files
```

> ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§ã¯ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã€‚`data/job.failed`ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ã€`data/logs/rdesys.log`(å­˜åœ¨ã—ã¦ã„ã‚‹å ´åˆ)ãªã©ã‚’ç¢ºèªã—ã€å¿…è¦ãªå¯¾å‡¦ã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚

ç™»éŒ²ã‚·ãƒ¼ãƒˆã®"ã‚·ãƒ¼ãƒˆå"ã«ã¯ç‰¹ã«åˆ¶é™ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ExcelãŒè¨±å®¹ã™ã‚‹ç¯„å›²ã§è‡ªç”±ã«ã‚·ãƒ¼ãƒˆåã‚’æ±ºå®šã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆæ™‚ã®`Sheet 1`ã‚„`Sheet1`ã§ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚

### Excelãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ(ç·¨é›†)

ä¸Šè¨˜ã‚’è¸ã¾ãˆã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã„ãã¾ã™ã€‚

RDEToolKitã«ã¯ã€ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ä½¿ç”¨ã™ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã®ã²ãªå½¢ã‚’ä½œæˆã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã®ã§ã€ã“ã‚Œã‚’ä½¿ã„ã¾ã™ã€‚

ã²ãªå½¢ã‚’ä½œæˆã™ã‚‹ã«ã¯ã€`make-excelinvoice`ã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```bash
(venv) $ python -m rdetoolkit make-excelinvoice data/tasksupport/invoice.schema.json
ğŸ“„ Generating ExcelInvoice template...
:
âœ¨ ExcelInvoice template generated successfully! : /home/devel/rde-sample/excelinvoice/container/template_excel_invoice.xlsx
```

> ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã€`template_excel_invoice.xlsx`ã¨ã„ã†åå‰ã§ä½œæˆã•ã‚Œã¾ã—ãŸã€‚
>
> ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã™ã‚‹å ´åˆã¯ã€(æœ«å°¾ã«)`-m folder`ã‚’è¿½åŠ ã—ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€MS ExcelãŒç¨¼åƒã™ã‚‹PC(Windowsã€Mac)ã«ã‚³ãƒ”ãƒ¼(ã‚‚ã—ãã¯ç§»å‹•)ã—ã¾ã™ã€‚

![template_excel_invoice_tempalte.png](./images/template_excel_invoice_template.png)

> `generalTerm`ãŠã‚ˆã³`specificTerm`ã®ã‚·ãƒ¼ãƒˆã¯ã€ç©ºã®ã‚·ãƒ¼ãƒˆã¨ã—ã¦ã§ã‚‚å¿…è¦ãªã‚·ãƒ¼ãƒˆã§ã™ã€‚ã“ã‚Œã‚‰2ã¤ã®ã‚·ãƒ¼ãƒˆã¯å¿…è¦ãªæƒ…å ±ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã®ã§ã€ä¿®æ­£ä¸è¦ã§ã™ã€‚
>
> `_version`ã®ã‚·ãƒ¼ãƒˆã«ã¯ã€ç”Ÿæˆã—ãŸRDEToolKitã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ãŒã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã¾ã™ã€‚å½“è©²ã‚·ãƒ¼ãƒˆã¯å­˜åœ¨ã—ã¦ã„ã¦ã‚‚å•é¡Œã‚ã‚Šã¾ã›ã‚“ã®ã§ã€é€šå¸¸ã¯ãã®ã¾ã¾ä¿æŒã—ã¦ãã ã•ã„ã€‚

#### A1ã‚»ãƒ«

`invoice_form`ã®ã‚·ãƒ¼ãƒˆã‚’é¸æŠã—ã¾ã™ã€‚

> å‰è¿°ã®æ§˜ã«ã‚·ãƒ¼ãƒˆåã¯ä»»æ„ã§ã™ã€‚ã“ã“ã§ã¯å¤‰æ›´ã›ãšã«ãã®ã¾ã¾åˆ©ç”¨ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚

A1ã‚»ãƒ«(ã‚·ãƒ¼ãƒˆã®å·¦ä¸Šç«¯)ã®å€¤ãŒ`invoiceList_format_id`ã§ã‚ã‚‹ã®ã‚’ç¢ºèªã—ã¾ã™ã€‚

> ãã†ãªã£ã¦ã„ã‚‹ã¯ãšãªã®ã§ã€ç¢ºèªã ã‘ã§OKã§ã™ã€‚

#### A2ã‚»ãƒ«

ä»Šå›ã¯ã€"ãƒ•ã‚¡ã‚¤ãƒ«ãƒ¢ãƒ¼ãƒ‰"ã§ã™ã®ã§ã€`data_file_names`ã§ã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

"ãƒ•ã‚©ãƒ«ãƒ€ãƒ¢ãƒ¼ãƒ‰"ã‚’ä½¿ã†å ´åˆã¯ã€`data_folder`ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

#### 2è¡Œç›®(A2ã‚’é™¤ã)ã€3è¡Œç›®

ã‚¤ãƒ³ãƒœã‚¤ã‚¹ã®é …ç›®åãŒå…¥ã‚Šã¾ã™ã®ã§ã€åŸºæœ¬çš„ã«**å¤‰æ›´ã—ãªã„**ã§ãã ã•ã„ã€‚

#### 4è¡Œç›®

2ã€3è¡Œç›®ã§ç¤ºã—ãŸé …ç›®åã®ã€æ—¥æœ¬èªåãŒå…¥ã‚Šã¾ã™ã€‚ã“ã“ã‚‚**ä¿®æ­£ä¸è¦**ã§ã™ã€‚

> ã“ã®è¡Œã¯ã€å…¥åŠ›ã™ã‚‹æ‹…å½“è€…å‘ã‘ã«ã‚ã‚‹è¡Œã§ã™ã€‚æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œã«ã¯å½±éŸ¿ã‚’ä¸ãˆã¾ã›ã‚“ã€‚
> åˆ¥ã®é …ç›®åã«å¤‰æ›´ã™ã‚‹ãªã©ã—ã¦ã‚‚å½±éŸ¿ã¯ãªã„ã§ã™ãŒã€æ··ä¹±ã®ã‚‚ã¨ã¨ãªã‚Šã¾ã™ã®ã§ã€ä¿®æ­£ã—ãªã„ã§ãã ã•ã„ã€‚
> 
> ã¾ãŸã‚»ãƒ«ã®ä¸­ã«æ”¹è¡Œã‚’å«ã‚€ã‚‚ã®ãŒã‚ã‚Šã¾ã™ãŒã€ã†ã¾ãæ”¹è¡Œã•ã‚Œãšã«è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã‚«ãƒ¼ã‚½ãƒ«ã‚’æŒã£ã¦ã„ãã€ã„ã£ãŸã‚“ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«ã—ã¦ã‹ã‚‰ç¢ºå®šã™ã‚‹ã¨æ­£ã—ãæ”¹è¡Œã•ã‚Œã¾ã™ã€‚æ°—ã«ãªã‚‹å ´åˆã¯ãŠè©¦ã—ãã ã•ã„ã€‚

### 5è¡Œç›®ä»¥é™

é€ã‚ŠçŠ¶ãƒ‡ãƒ¼ã‚¿ã‚’ã€1è¡Œãšã¤æ›¸ã„ã¦ã„ãã¾ã™ã€‚

* 4è¡Œç›®ã®æ—¥æœ¬èªé …ç›®åã«`(å¿…é ˆ)`ã¨æ›¸ã‹ã‚ŒãŸé …ç›®ã¯ã€å¿…ãšå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚å…¥åŠ›ãŒæ¼ã‚Œã¦ã„ãŸå ´åˆã¯ã€æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œæ™‚ã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã¨ã—ã¦ã€ä»¥ä¸‹ã‚’ã„ã‚Œã¾ã™ã€‚

> ã‚µãƒ³ãƒ—ãƒ«å€¤ã§ã™ã®ã§ã€å¤‰æ›´ã—ã¦å…¥åŠ›ã—ã¦ã‚‚æ§‹ã„ã¾ã›ã‚“ã€‚ã‚µãƒ³ãƒ—ãƒ«ã§ã™ã®ã§ã€å¤šãã®åˆ—ã§ã€ã¾ã£ãŸãæ„å‘³ãŒãªã„ãƒ‡ãƒ¼ã‚¿ã¨ãªã£ã¦ã„ã¾ã™ã€‚
>
> ä¸‹è¨˜ä¾‹ã§ã¯ã€"å…¥åŠ›å€¤"æ¬„ã«3ã¤ä¾‹ç¤ºãŒæœ‰ã‚‹å ´åˆã¯è¡Œæ¯ã®ã€1å€‹ã—ã‹ãªã„å ´åˆã¯ã€3è¡Œã¨ã‚‚åŒã˜å€¤ã‚’ä½¿ã„ã¾ã™ã€‚

| åˆ—å | åˆ—ç•ªå· | å…¥åŠ›å€¤ | å‚™è€ƒ |
| ---- | ---- | ---- | ---- |
| ãƒ•ã‚¡ã‚¤ãƒ«å (æ‹¡å¼µå­ã‚‚å«ã‚å…¥åŠ›) | Aåˆ— | data0000.datã€data0001.datã€data0002.dat | å±•é–‹å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’æ‹¡å¼µå­è¾¼ã¿ã§ã‚»ãƒƒãƒˆ |
| ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆå | Båˆ— | Dummy | å¿…é ˆã ãŒã€ãƒ€ãƒŸãƒ¼ã§ã‚ˆã„ (æœ¬å½“?) |
| ãƒ‡ãƒ¼ã‚¿æ‰€æœ‰è€… | Cåˆ— | (ç©ºæ¬„) | |
| NIMS user UUID | Dåˆ— | 97e05f8b9ed6b4b5dd6fd50411a9c163a2d4e38d6264623666383669 | å…¨éƒ¨åŒã˜ã§ã‚ˆã„ |
| ãƒ‡ãƒ¼ã‚¿å | Eåˆ— | data0000.datã€data0001.datã€data0002.dat | Aåˆ—ã¨åŒå€¤ |
| å®Ÿé¨“ID | Fåˆ— | (ç©ºæ¬„) | |
| èª¬æ˜ | Gåˆ— | (ç©ºæ¬„) | |
| è©¦æ–™å(ãƒ­ãƒ¼ã‚«ãƒ«ID) | Håˆ— | Inuã€Nekoã€(ç©ºæ¬„) | 7è¡Œç›®ã ã‘ç©ºæ¬„ã«ã—ã¾ã™ã€‚ |
| è©¦æ–™UUID | Iåˆ— | (ç©ºæ¬„) | |
| è©¦æ–™ç®¡ç†è€…UUID | Jåˆ— | de17c7b3f0ff5126831c2d519f481055ba466ddb6238666132316439 | å…¨éƒ¨åŒã˜ã§ã‚ˆã„ |
| åŒ–å­¦å¼ãƒ»çµ„æˆå¼ãƒ»åˆ†å­å¼ãªã© | Kåˆ— | (ç©ºæ¬„) | |
| å‚è€ƒURL | Låˆ— | (ç©ºæ¬„) | |
| è©¦æ–™ã®èª¬æ˜ | Måˆ— | (ç©ºæ¬„) | |
| ä¸€èˆ¬åç§° | Nåˆ— | A1ã€B1ã€C1 | |
| CASç•ªå· | Oåˆ— | A2ã€B2ã€C2 | |
| çµæ™¶æ§‹é€  | Påˆ— | A3ã€B3ã€C3 | |
| è©¦æ–™å½¢çŠ¶ | Qåˆ— | A4ã€B4ã€C4 | |
| è©¦æ–™è³¼å…¥æ—¥ | Råˆ— | (ç©ºæ¬„) | |
| è³¼å…¥å…ƒ | Såˆ— | A6ã€B6ã€C6 | |
| ãƒ­ãƒƒãƒˆç•ªå·ã€è£½é€ ç•ªå·ãªã© | Tåˆ— | A7ã€B7ã€C7 | |
| æ—¥ä»˜ | Uåˆ— | (ç©ºæ¬„) | |
| åŸºæ¿ | Våˆ— | (ç©ºæ¬„) | |
| å±¤æ§‹é€  | Wåˆ— | (ç©ºæ¬„) | |
| æˆè†œæ¸©åº¦ | Xåˆ— | (ç©ºæ¬„) | |
| æˆè†œé…¸ç´ åœ§ | Yåˆ— | (ç©ºæ¬„) | |
| ãƒ¬ãƒ¼ã‚¶ãƒ¼å¼·åº¦ | Zåˆ— | (ç©ºæ¬„) | |
| ãƒ¬ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒãƒƒãƒˆã‚µã‚¤ã‚º | AAåˆ— | (ç©ºæ¬„) | |
| ãƒ¬ãƒ¼ã‚¶ãƒ¼å‘¨æ³¢æ•° | ABåˆ— | (ç©ºæ¬„) | |
| æˆè†œãƒ‘ãƒ«ã‚¹æ•° | ACåˆ— | (ç©ºæ¬„) | |
| ã‚­ãƒ¼1 | ADåˆ— | ã‚1ã€ã‚2ã€ã‚3 | |
| ã‚­ãƒ¼2 | AEåˆ— | ã„1ã€ã„2ã€ã„3 | |
| ã‚­ãƒ¼3 | AFåˆ— | ã†1ã€ã†2ã€ã†3 | |
| ã‚­ãƒ¼4 | AGåˆ— | ãˆ1ã€ãˆ2ã€ãˆ3 | |
| ã‚­ãƒ¼5 | AHåˆ— | ãŠ1ã€ãŠ2ã€ãŠ3 | |
| ç™»éŒ²ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ— | AIåˆ— | (ç©ºæ¬„) | |
| ãƒ‡ãƒ¼ã‚¿ã®èµ·æº | AJåˆ— | (ç©ºæ¬„) | |
| æŠ€è¡“ã‚«ãƒ†ã‚´ãƒªãƒ¼ | AKåˆ— | (ç©ºæ¬„) | |
| å‚è€ƒæ–‡çŒ® | ALåˆ— | (ç©ºæ¬„) | |
| å‡¦ç†å¹´æœˆæ—¥ | AMåˆ— | (ç©ºæ¬„) | |
| ãƒ—ãƒ­ã‚»ã‚¹ã‚«ãƒ†ã‚´ãƒªãƒ¼ | ANåˆ— | (ç©ºæ¬„) | |
| ãƒ—ãƒ­ã‚»ã‚¹æ‰‹æ³• | AOåˆ— | (ç©ºæ¬„) | |
| å‡¦ç†ç’°å¢ƒ | APåˆ— | (ç©ºæ¬„) | |
| ä¸»ã¨ãªã‚‹å‡¦ç†æ¸©åº¦ | AQåˆ— | (ç©ºæ¬„) | |
| è£…ç½®è¨­ç½®å ´æ‰€ | ARåˆ— | (ç©ºæ¬„) | |
| æ¨™æº–æ‰‹é † | ASåˆ— | (ç©ºæ¬„) | |

### ãã®ä»–ã®æ³¨æ„ç‚¹

2åˆ—ç›®ä»¥é™ã«`ç©ºã®åˆ—`ã‚’è¿½åŠ ã—ã¦ã‚‚ã€é …ç›®å(2è¡Œç›®ã¨3è¡Œç›®)ãŒç©ºã®å ´åˆã¯å½±éŸ¿ã‚ã‚Šã¾ã›ã‚“ã€‚

5è¡Œç›®ä»¥é™ã¯ã€é€”ä¸­ã®è¡Œã«`ç©ºã®è¡Œ`ãŒã‚ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

é€”ä¸­ã«ç©ºã®è¡Œã®ã‚ã‚‹Excelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨ã„ã¦æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã—ãŸå ´åˆã¯ã€ä»¥ä¸‹ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ã¨ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ cat data/job.failed 
ErrorCode=1
ErrorMessage=Error! Blank lines exist between lines
```

## ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œ

ä¸Šè¨˜å†…å®¹ã‚’å…¥åŠ›â†’ä¿å­˜ã—ãŸExcelãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã€`data/inputdata`ãƒ•ã‚©ãƒ«ãƒ€ã«é…ç½®ã—ã¾ã™ã€‚

```bash
(venv) $ tree data/inputdata/
data/inputdata/
â”œâ”€â”€ Template_excel_invoice.xlsx
â””â”€â”€ data.zip

1 directory, 2 files
```

> è»¢é€ã®ä»•æ–¹ã«ã‚ˆã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«åã®1æ–‡å­—ç›®ãŒå¤§æ–‡å­—ã«å¤‰æ›´ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚

ç¶šã„ã¦ã€(é€šå¸¸ã®)ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œçµæœã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚

```bash
./reinit.sh
```

ã“ã®çŠ¶æ…‹ã§ã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
python main.py
```

å‡ºæ¥ä¸ŠãŒã£ãŸãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆã¯ä»¥ä¸‹ã®æ§˜ã«ãªã‚Šã¾ã™ã€‚

```bash
(venv) $ tree data
data
â”œâ”€â”€ attachment
â”œâ”€â”€ divided
â”‚Â Â  â”œâ”€â”€ 0001
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ attachment
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ invoice
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ invoice.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ invoice_patch
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ logs
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ main_image
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ meta
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ metadata.json
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ nonshared_raw
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ data0001.dat
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ other_image
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ raw
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ structured
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ sample.csv
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ temp
â”‚Â Â  â”‚Â Â  â””â”€â”€ thumbnail
â”‚Â Â  â””â”€â”€ 0002
â”‚Â Â      â”œâ”€â”€ attachment
â”‚Â Â      â”œâ”€â”€ invoice
â”‚Â Â      â”‚Â Â  â””â”€â”€ invoice.json
â”‚Â Â      â”œâ”€â”€ invoice_patch
â”‚Â Â      â”œâ”€â”€ logs
â”‚Â Â      â”œâ”€â”€ main_image
â”‚Â Â      â”œâ”€â”€ meta
â”‚Â Â      â”‚Â Â  â””â”€â”€ metadata.json
â”‚Â Â      â”œâ”€â”€ nonshared_raw
â”‚Â Â      â”‚Â Â  â””â”€â”€ data0002.dat
â”‚Â Â      â”œâ”€â”€ other_image
â”‚Â Â      â”œâ”€â”€ raw
â”‚Â Â      â”œâ”€â”€ structured
â”‚Â Â      â”‚Â Â  â””â”€â”€ sample.csv
â”‚Â Â      â”œâ”€â”€ temp
â”‚Â Â      â””â”€â”€ thumbnail
â”œâ”€â”€ inputdata
â”‚Â Â  â”œâ”€â”€ Template_excel_invoice.xlsx
â”‚Â Â  â””â”€â”€ data.zip
â”œâ”€â”€ invoice
â”‚Â Â  â”œâ”€â”€ invoice.json
â”‚Â Â  â””â”€â”€ invoice.json.orig
â”œâ”€â”€ invoice_patch
â”œâ”€â”€ logs
â”œâ”€â”€ main_image
â”œâ”€â”€ meta
â”‚Â Â  â””â”€â”€ metadata.json
â”œâ”€â”€ nonshared_raw
â”‚Â Â  â””â”€â”€ data0000.dat
â”œâ”€â”€ other_image
â”œâ”€â”€ raw
â”œâ”€â”€ structured
â”‚Â Â  â””â”€â”€ sample.csv
â”œâ”€â”€ tasksupport
â”‚Â Â  â”œâ”€â”€ invoice.schema.json
â”‚Â Â  â””â”€â”€ metadata-def.json
â”œâ”€â”€ temp
â”‚Â Â  â”œâ”€â”€ data0000.dat
â”‚Â Â  â”œâ”€â”€ data0001.dat
â”‚Â Â  â”œâ”€â”€ data0002.dat
â”‚Â Â  â””â”€â”€ invoice_org.json
â””â”€â”€ thumbnail

42 directories, 21 files
```

å‰è¿°ã®ã‚ˆã†ã«ã€æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ä¿®æ­£ä¸è¦ã§ã™ã€‚`data/inputdata`ãƒ•ã‚©ãƒ«ãƒ€ä¸Šã«ã€å˜ç‹¬ã®å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã®ã§ã¯ãªãã€zipåœ§ç¸®ã•ã‚ŒãŸå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã¨Excelã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ•ã‚¡ã‚¤ãƒ«(xlsxãƒ•ã‚¡ã‚¤ãƒ«)ã‚’é…ç½®ã™ã‚‹ã ã‘ã§ã€é€šå¸¸ã®ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ãŒã‚¨ã‚¯ã‚»ãƒ«ã‚¤ãƒ³ãƒœã‚¤ã‚¹ãƒ¢ãƒ¼ãƒ‰ã«å¤‰ã‚ã‚Šã¾ã™ã€‚

è¤‡æ•°ã®ãƒ‡ãƒ¼ã‚¿ã‚¿ã‚¤ãƒ«ã«å¯¾å¿œã™ã‚‹ãŸã‚ã€dividedãƒ•ã‚©ãƒ«ãƒ€ãŒæ–°è¦ã«ä½œæˆã•ã‚Œã€ã•ã‚‰ã«4æ¡æ•°å­—é€£ç•ªã®ã‚µãƒ–ãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã•ã‚Œã¾ã™ã€‚ã‚‚ã¨ã®`data`ãƒ•ã‚©ãƒ«ãƒ€ã«1è¡Œç›®ã®ãƒ‡ãƒ¼ã‚¿å‡¦ç†çµæœãŒã€`data/divided/0001`ã«2è¡Œç›®ã®ãƒ‡ãƒ¼ã‚¿ãŒã€`data/divided/0002`ã«3è¡Œç›®ã®ãƒ‡ãƒ¼ã‚¿ãŒãã‚Œãã‚Œæ ¼ç´ã•ã‚Œã¾ã™ã€‚

ä¾‹ãˆã°ã€ç”Ÿæˆã•ã‚ŒãŸinvoice.jsonã®ã‚­ãƒ¼1ï½ã‚­ãƒ¼5ã¾ã§ã®éƒ¨åˆ†ã‚’ä»¥ä¸‹ã«ç¤ºã—ã¾ã™ã€‚

data/invoice/invoice.json

```json
:
    "custom": {
        "key1": "ã‚1",
        "key2": "ã„1",
        "key3": "ã†1",
        "key4": "ãˆ1",
        "key5": "ãŠ1",    
:
```

data/divided/0001/invoice/invoice.json

```json
:
    "custom": {
        "key1": "ã‚2",
        "key2": "ã„2",
        "key3": "ã†2",
        "key4": "ãˆ2",
        "key5": "ãŠ2",    
:
```

data/divided/0002/invoice/invoice.json

```json
:
    "custom": {
        "key1": "ã‚3",
        "key2": "ã„3",
        "key3": "ã†3",
        "key4": "ãˆ3",
        "key5": "ãŠ3",    
:
```

> ä¸Šã®æ§˜ã«ã€key1ï½key5ãŒé †ç•ªã«ä¸¦ã¶ã¨ã¯é™ã‚Šã¾ã›ã‚“ã€‚

ã¾ãŸä¸Šã®ä¾‹ã§ã¯ã€3ã¤ç›®(ã‚·ãƒ¼ãƒˆä¸Šã¯7è¡Œç›®)ã®`è©¦æ–™å(ãƒ­ãƒ¼ã‚«ãƒ«ID)`ã‚’ç©ºæ¬„ã«ã—ã¾ã—ãŸã€‚æ§‹é€ åŒ–å‡¦ç†ãƒ—ãƒ­ã‚°ãƒ©ãƒ å®Ÿè¡Œã®çµæœã‚’ç¢ºèªã™ã‚‹ã¨ä»¥ä¸‹ã®æ§˜ã«ãªã£ã¦ã„ã¾ã™ã€‚

data/divided/0002/invoice/invoice.json

```json
:
    "sample": {
        "sampleId": null,
        "names": [
            "testdev01_1"
        ],
:
```

ã“ã®"testdev01_1"ã¯ã€ã‚‚ã¨ã®invoice.jsonã®`sample.names`ã®å€¤ãŒè»¢è¨˜ã•ã‚Œã¦ã„ã¾ã™ã€‚

```bash
(venv) $ vi data/invoice/invoice.json.orig
:
:
    "sample": {
        "sampleId": "8ea50153-7a87-44b7-9d6e-10179c507039",
        "names": [
            "testdev01_1"  (â˜…)
        ],
        "composition": "AB2C3",
        "referenceUrl": "test_ref",
:
```

> Excelãƒ•ã‚¡ã‚¤ãƒ«ã«æŒ‡å®šãŒç„¡ã‹ã£ãŸã®ã§ã€ä¸Šè¨˜ã®(â˜…)ã®è¡Œã®ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨ã•ã‚ŒãŸã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚

data.zipã¯`data/temp/`ãƒ•ã‚©ãƒ«ãƒ€ä¸Šã§å±•é–‹ã•ã‚Œã€ãã‚Œãã‚Œã®`nonshared_raw/`ãƒ•ã‚©ãƒ«ãƒ€ã«å±•é–‹ã•ã‚Œã¾ã™ã€‚

```bash
(venv) $ tree -f data | grep \\.dat
â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ data/divided/0001/nonshared_raw/data0001.dat
â”‚Â Â      â”‚Â Â  â””â”€â”€ data/divided/0002/nonshared_raw/data0002.dat
â”‚Â Â  â””â”€â”€ data/nonshared_raw/data0000.dat
:
â”‚Â Â  â”œâ”€â”€ data/temp/data0000.dat
â”‚Â Â  â”œâ”€â”€ data/temp/data0001.dat
â”‚Â Â  â”œâ”€â”€ data/temp/data0002.dat
```

